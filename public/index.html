<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RapidStay - Expedia Hotel Finder</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #fafafa; }
    h1 { text-align: center; }
    .lang-switch { text-align: right; margin-bottom: 10px; }
    button { margin: 3px; padding: 6px 12px; border: none; border-radius: 6px; background: #007bff; color: #fff; cursor: pointer; }
    button:hover { background: #0056b3; }
    .search-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; margin: 20px 0; }
    input, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    #results { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
    .card { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 15px; }
    .card img { width: 100%; border-radius: 10px; }
    .card h3 { margin: 10px 0 5px; }
    .card p { margin: 0; font-size: 14px; }
  </style>
</head>
<body>
  <div class="lang-switch">
    🌐 
    <button onclick="switchLang('ko','KRW')">한국어</button>
    <button onclick="switchLang('en','USD')">English</button>
    <button onclick="switchLang('ja','JPY')">日本語</button>
    <button onclick="switchLang('es','USD')">Español</button>
  </div>

  <h1 id="page-title">Expedia 데이터로 보는 오늘의 호텔 최저가</h1>

  <div class="search-box">
    <input id="city" placeholder="도시 또는 랜드마크 입력">
    <input id="checkin" type="date">
    <input id="checkout" type="date">
    <input id="adults" type="number" min="1" value="2" placeholder="성인 수">
    <input id="children" type="number" min="0" value="0" placeholder="아동 수">
    <button onclick="searchHotels()">검색</button>
  </div>

  <div id="results"></div>

  <script>
    let locale = 'ko';
    let currency = 'KRW';

    // 🔹 브라우저 언어 감지
    const userLang = navigator.language || navigator.userLanguage;
    if (userLang.startsWith('en')) { locale = 'en'; currency = 'USD'; }
    else if (userLang.startsWith('ja')) { locale = 'ja'; currency = 'JPY'; }
    else if (userLang.startsWith('es')) { locale = 'es'; currency = 'USD'; }

    function switchLang(lang, cur) {
      locale = lang;
      currency = cur;
      alert(`언어: ${lang}, 통화: ${cur} 로 변경되었습니다.`);
    }

    async function searchHotels() {
      const city = document.getElementById('city').value;
      const checkin = document.getElementById('checkin').value;
      const checkout = document.getElementById('checkout').value;
      const adults = document.getElementById('adults').value;
      const children = document.getElementById('children').value;
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '검색 중...';

      // 🔹 목적지 ID 조회
      const destUrl = `https://booking-com15.p.rapidapi.com/api/v1/hotels/searchDestination?query=${encodeURIComponent(city)}`;
      const options = {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': 'YOUR_RAPIDAPI_KEY',
          'X-RapidAPI-Host': 'booking-com15.p.rapidapi.com'
        }
      };
      const destRes = await fetch(destUrl, options);
      const destData = await destRes.json();
      if (!destData.data || destData.data.length === 0) {
        resultsDiv.innerHTML = '검색 결과가 없습니다.';
        return;
      }

      const destId = destData.data[0].dest_id;

      // 🔹 호텔 검색
      const searchUrl = `https://booking-com15.p.rapidapi.com/api/v1/hotels/searchHotels?dest_id=${destId}&search_type=CITY&adults_number=${adults}&children_number=${children}&checkin_date=${checkin}&checkout_date=${checkout}&locale=${locale}&currency_code=${currency}&sort_by=popularity`;

      const hotelRes = await fetch(searchUrl, options);
      const hotelData = await hotelRes.json();
      if (!hotelData.data || hotelData.data.length === 0) {
        resultsDiv.innerHTML = '호텔을 찾을 수 없습니다.';
        return;
      }

      // 🔹 카드 렌더링
      resultsDiv.innerHTML = '';
      hotelData.data.forEach(h => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <img src="${h.property.photoUrls[0]}" alt="${h.property.name}">
          <h3>${h.property.name}</h3>
          <p>${h.accessibilityLabel}</p>
          <p><b>${h.priceBreakdown?.grossPrice?.value || 'N/A'} ${currency}</b></p>
          <a href="${h.property.reviewScoreWord}" target="_blank">Expedia에서 보기</a>
        `;
        resultsDiv.appendChild(div);
      });
    }
  </script>
</body>
</html>
